<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycompany.kosa_space.dao.AttendanceNotesDao">
   
   <insert id="insert" parameterType="attendancenotes">
   		insert into attendancenotes(
			mid, adate, ancategory, anreason, anconfirm,
			anattachoname, anattachtype, anattach, ancreatedat
		)
		values (
			#{mid}, #{adate}, #{ancategory}, #{anreason}, #{anconfirm},
			#{anattachoname}, #{anattachtype},#{anattach}, sysdate
		)	
   </insert>
   
   <select id="selectByMidAndAdate" parameterType="map" resultType="attendancenotes">
   		select *
   		from attendancenotes
   		where mid=#{mid} and adate=#{adate}
   </select>
   
   <update id="update" parameterType="attendancenotes">
   		update attendancenotes set 
      	ancategory=#{ancategory}, anreason=#{anreason}, anupdatedat=sysdate
      	<if test="anattachoname != null">
      		, anattachoname=#{anattachoname}
      		, anattachtype=#{anattachtype}
      		, anattach=#{anattach}
      	</if>
      where mid=#{mid} and adate=#{adate}
   </update>
   
   <update id="approve" parameterType="map">
   		update attendancenotes set
   			anconfirm=1
   		where mid=#{mid} and adate=#{adate}
   </update>
   
   <select id="selectReasonByMid" parameterType="map" resultType="attendanceinforesponsedto">
   		select *
		from (
		    select a.mid, a.cno, a.adate, a.acheckin, a.acheckout, a.astatus, a.aconfirm, an.anconfirm,
		        an.ancategory, an.anreason, an.anattach, an.anattachoname, an.anattachtype,
		        a.approvecnt, a.latenesscnt, a.absencecnt, a.acheckinstatus, a.acheckoutstatus,
		        an.ancreatedat, an.anupdatedat
		    from attendance a, attendancenotes an
		    where a.mid = an.mid
		)
		where mid=#{mid} and adate=#{adate}
   </select>
   
</mapper>