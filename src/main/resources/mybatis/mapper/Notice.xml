<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycompany.kosa_space.dao.NoticeDao">
   
   <insert id="insert" parameterType="notice">
   		<selectKey keyProperty="nno" resultType="int" order="BEFORE">
			select seq_nno.nextval from dual
		</selectKey>
		insert into notice(
			nno, ecno, cno, mid, ncategory, 
			ntitle, ncontent, nhitcount, 
			nattach, nattachoname, nattachtype, ncreatedat
		)
		values (
			#{nno}, #{ecno}, #{cno}, #{mid}, #{ncategory},
			#{ntitle}, #{ncontent}, #{nhitcount},
			#{nattach}, #{nattachoname}, #{nattachtype}, sysdate
		)
   </insert>
   
   <select id="selectNoticeByEcname" parameterType="int" resultType="notice">
   		select distinct ncategory, ntitle, ecno, ncreatedat 
		from notice
		where ecno = #{ecno}
   </select>
   
   <select id="selectNoticePagerByEcname" parameterType="map" resultType="notice">
   		<![CDATA[
			select rnum,ncategory, ntitle, ecno, ncreatedat 
			from (
			    select rownum as rnum,ncategory, ntitle, ecno, ncreatedat 
			    from (
			        select distinct ncategory, ntitle, ecno, ncreatedat 
			        from notice
			        where ecno = #{ecno}
			        order by ncreatedat desc
			    )
			    where rownum <= #{pager.endRowNo}
			) where rnum >= #{pager.startRowNo}
   		]]>
   </select>
   
</mapper>